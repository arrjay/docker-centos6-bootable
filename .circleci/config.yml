version: 2

jobs:
  build:
    docker:
       - image: docker.palantir.build/circle2-build-images/ubuntu-jdk-npm:0.19.0
    working_directory: ~/project
    environment:
      - DOCKER_SINK=docker.palantir.build/computetools
    steps:
      - checkout
      - setup_remote_docker
      - run:
          name: build images
          command: ./build.sh
      - run:
          name: docker login
          command: |
              docker login -u $ARTIFACTORY_USERNAME -p $ARTIFACTORY_PASSWORD docker.palantir.build
      - run:
          name: push base images
          command: ./publish.sh
